{% extends 'recipes/base.html' %}
{% block title %}{{ recipe.title }}{% endblock %}
{% block content %}
<div class="recipe-page">
  <div class="paper">
    {% if recipe.image %}
    <div class="pinned-image">
      <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}">
    </div>
    {% endif %}

    <h1 class="recipe-title">{{ recipe.title }}</h1>

    {% if recipe.description %}
    <p class="recipe-description">{{ recipe.description }}</p>
    {% endif %}

    <p class="meta text-muted">
      {{ recipe.get_category_display }}
      {% if recipe.cook_time_minutes %} â€¢ {{ recipe.cook_time_minutes }} mins{% endif %}
    </p>

    <h2>Ingredients</h2>
    <ul class="ingredients">
      {% for line in recipe.ingredients.splitlines %}
      <li>{{ line }}</li>
      {% endfor %}
    </ul>

    <h2>Instructions</h2>
    <ol class="instructions">
      {% for step in recipe.steps.splitlines %}
      <li>{{ step }}</li>
      {% endfor %}
    </ol>
  </div>
</div>

{% if user.is_authenticated and user == recipe.owner %}
  <div class="mt-3 d-flex gap-2">
    <a href="{% url 'recipe_edit' recipe.pk %}" class="btn btn-outline-primary btn-sm">Edit</a>
    <a href="{% url 'recipe_delete' recipe.pk %}" class="btn btn-outline-danger btn-sm">Delete</a>
  </div>
{% endif %}

<hr>

<div class="comments-section">
  <h2 id="comments-title" class="h5 mt-4">Comments</h2>

  {% if user.is_authenticated %}
    <form method="post" class="mb-3">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit" class="btn btn-primary btn-sm">Add Comment</button>
    </form>
  {% else %}
    <p>You must <a href="{% url 'login' %}?next={{ request.path }}">log in</a> to leave a comment.</p>
  {% endif %}

  {% for comment in comments %}
  <div class="comment mb-3 p-2 border rounded">
    <strong>{{ comment.author.username }}</strong>
    <small class="text-muted">{{ comment.created_at|date:"M d, Y H:i" }}</small>
    <p class="mb-1">{{ comment.text }}</p>
    {% if user == recipe.owner or user == comment.author %}
      <a href="{% url 'comment_delete' comment.pk %}" class="btn btn-outline-danger btn-sm">Delete</a>
    {% endif %}
  </div>
{% empty %}
  <p class="text-muted">No comments yet. Be the first to share your thoughts!</p>
{% endfor %}

</div>
{% endblock %}
